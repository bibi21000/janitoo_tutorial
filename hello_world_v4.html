<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HelloWord V4 &#8212; janitoo_tutorial 0.0.7 documentation</title>
    
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TK User Interface" href="tkinter.html" />
    <link rel="prev" title="Discovering network" href="discovering_network.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          janitoo_tutorial</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.7</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="tools/index.html">Tools</a></li>
                <li><a href="api/index.html">Reference</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html"> What is Janitoo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#preface">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#about-this-tutorial">About this tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html"> Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#needed-tools">Needed tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#initial-clone">Initial clone</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-mosquitto">Install mosquitto</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-modules">Install modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-client-tools">Install Client tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#update-your-clone">Update your clone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v0.html"> Hello World : connect everything</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#needed-parts">Needed parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#fritzing">Fritzing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v1.html"> Hello World 1 : a simple server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#test-it">Test it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#launch-it">Launch it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#query-it">Query it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v2.html"> Hello World 2 : an advanced server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-components">The components</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-bus">The bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-thread">The thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#entry-points">Entry-points</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#test-it">Test it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#launch-it">Launch it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v3.html"> Hello World 3 : a more advanced server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#the-bus">The bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#the-finish-state-machine">The finish state machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#create-a-server">Create a server</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#spy-it">Spy it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#start-it-at-boot">Start it at boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="many_servers.html"> Many servers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#mosquitto">Mosquitto</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#the-docker-appliance">The docker appliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#home-automation">Home automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#the-network">The network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="discovering_network.html"> Discovering the network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#one-more-server">One more server</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#broadcast-network">Broadcast network</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#request-nodes">Request nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#values-querying">Values querying</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#command-class-discovering">Command class discovering</a></li>
<li class="toctree-l2"><a class="reference internal" href="discovering_network.html#more-servers">More servers</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Hello World 4 : interacting with our server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#state-machine">State machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wake-up-baby">Wake up baby</a></li>
<li class="toctree-l2"><a class="reference internal" href="#critical-temperature">Critical temperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fsmbus">FsmBus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tkinter.html"> Tk user interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#id1">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#the-map">The map</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#the-contextual-menu">The contextual menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#future">Future</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="more.html"> Create and share</a><ul>
<li class="toctree-l2"><a class="reference internal" href="more.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#how">How</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#bus-aggregation-vs-bus-extension">Bus aggregation vs bus extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#remote-development">Remote development</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#i-want-more">I want more</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#i-want-to-help">I want to help</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using_doc.html"> Using documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="using_doc.html#the-header">The header</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="discovering_network.html" title="Previous Chapter: Discovering network"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Discovering network</span>
    </a>
  </li>
  <li>
    <a href="tkinter.html" title="Next Chapter: TK User Interface"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">TK User Interface &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="helloword-v4">
<h1>HelloWord V4<a class="headerlink" href="#helloword-v4" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goal">
<h2>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h2>
<p>Back to our Rapsberry pi server : .
For the impatient that did not use a raspberry, you can jump <a class="reference internal" href="more.html"><span class="doc">here</span></a></p>
</div>
<div class="section" id="state-machine">
<h2>State machine<a class="headerlink" href="#state-machine" title="Permalink to this headline">¶</a></h2>
<p>Look at the spyer. At startup, the server publish all its values but after a while it became silently :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span><span class="o">/</span><span class="n">voltage</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The voltage of the CPU&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3__cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;entry</span>
<span class="n">_name</span><span class="s2">&quot;: &quot;</span><span class="n">sensor_voltage</span><span class="s2">&quot;, &quot;</span><span class="n">genre</span><span class="s2">&quot;: 2, &quot;</span><span class="n">poll_delay</span><span class="s2">&quot;: 300, &quot;</span><span class="n">data</span><span class="s2">&quot;: 1.35, &quot;</span><span class="n">is_polled</span><span class="s2">&quot;: true, &quot;</span><span class="n">is_writeonly</span><span class="s2">&quot;: false, &quot;</span><span class="n">list_items</span><span class="s2">&quot;: null, &quot;</span><span class="n">index</span><span class="s2">&quot;: 0, &quot;</span><span class="n">uuid</span><span class="s2">&quot;: &quot;</span><span class="n">volt</span>
<span class="n">age</span><span class="s2">&quot;, &quot;</span><span class="n">is_readonly</span><span class="s2">&quot;: true, &quot;</span><span class="nb">min</span><span class="s2">&quot;: null, &quot;</span><span class="n">default</span><span class="s2">&quot;: null, &quot;</span><span class="nb">type</span><span class="s2">&quot;: 3, &quot;</span><span class="n">cmd_class</span><span class="s2">&quot;: 49, &quot;</span><span class="n">hadd</span><span class="s2">&quot;: &quot;</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span><span class="s2">&quot;, &quot;</span><span class="n">label</span><span class="s2">&quot;: &quot;</span><span class="n">CPUVolt</span><span class="s2">&quot;, &quot;</span><span class="n">units</span><span class="s2">&quot;: &quot;</span><span class="n">V</span><span class="s2">&quot;}</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span><span class="o">/</span><span class="n">temperature</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3__temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;</span>
<span class="n">entry_name</span><span class="s2">&quot;: &quot;</span><span class="n">sensor_temperature</span><span class="s2">&quot;, &quot;</span><span class="n">genre</span><span class="s2">&quot;: 2, &quot;</span><span class="n">poll_delay</span><span class="s2">&quot;: 300, &quot;</span><span class="n">data</span><span class="s2">&quot;: 85.0, &quot;</span><span class="n">is_polled</span><span class="s2">&quot;: true, &quot;</span><span class="n">is_writeonly</span><span class="s2">&quot;: false, &quot;</span><span class="n">list_items</span><span class="s2">&quot;: null, &quot;</span><span class="n">index</span><span class="s2">&quot;: 0, &quot;</span><span class="n">uui</span>
<span class="n">d</span><span class="s2">&quot;: &quot;</span><span class="n">temperature</span><span class="s2">&quot;, &quot;</span><span class="n">is_readonly</span><span class="s2">&quot;: true, &quot;</span><span class="nb">min</span><span class="s2">&quot;: null, &quot;</span><span class="n">default</span><span class="s2">&quot;: null, &quot;</span><span class="nb">type</span><span class="s2">&quot;: 3, &quot;</span><span class="n">cmd_class</span><span class="s2">&quot;: 49, &quot;</span><span class="n">hadd</span><span class="s2">&quot;: &quot;</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span><span class="s2">&quot;, &quot;</span><span class="n">label</span><span class="s2">&quot;: &quot;</span><span class="n">Temp</span><span class="s2">&quot;, &quot;</span><span class="n">units</span><span class="s2">&quot;: &quot;</span>\<span class="n">u00b0C</span><span class="s2">&quot;}</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0001</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0001</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">tutorial3_state</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The state of the fsm.&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sensor_string&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;sleeping&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_state&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">}</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0001</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0001</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
</pre></div>
</div>
<p>That&#8217;s because we enter in mode sleep. As publish in the last value : &#8220;data&#8221;: &#8220;sleeping&#8221;. And we publish this value every 900seconds : &#8220;poll_delay&#8221;: 900.</p>
<p>That&#8217;s done in the check_heartbeat method :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check that the component is &#39;available&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1">#~ for bus in self.buses:</span>
        <span class="c1">#~ res = res and self.buses[bus].check_heartbeat()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - sensors </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">polled_sensors</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;booting&#39;</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polled_sensors</span><span class="p">):</span>
        <span class="c1">#We try to enter in sleeping mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;booting&#39;</span>
</pre></div>
</div>
<p>That&#8217;s not the fastest way to do it but not the worst. We need to check that all nodes are up before changing of state.
If the state is not change, the node associated to the bus will send an &#8216;OFFLINE&#8217; heartbeat.</p>
<p>We add a condition for the state machine : values needs to be up to change the state. Of course, no need to check conditions to get into sleeping state.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">condition_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - condition_values&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polled_sensors</span><span class="p">)</span>
</pre></div>
</div>
<p>And we add on_enter_{state} functions. For example, when entering in reporting mode, we activate the polls  :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_enter_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - on_enter_reporting&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus_acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="s1">&#39;led&#39;</span><span class="p">,</span> <span class="s1">&#39;blink&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;heartbeat&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">add_polls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polled_sensors</span><span class="p">,</span> <span class="n">slow_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#In sleeping mode, send the state of the fsm every 900 seconds</span>
        <span class="c1">#We update poll_delay directly to not update the value in configfile</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">poll_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;state_poll&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="n">overheat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat&#39;</span><span class="p">)</span>
        <span class="n">overheat</span><span class="o">.</span><span class="n">poll_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat_poll&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">publish_value</span><span class="p">(</span><span class="n">overheat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">add_polls</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="n">overheat</span><span class="p">],</span> <span class="n">slow_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - Error in on_enter_reporting&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_release</span><span class="p">()</span>
</pre></div>
</div>
<p>We also publish the overheat value immediatly :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">publish_value</span><span class="p">(</span><span class="n">overheat</span><span class="p">)</span>
</pre></div>
</div>
<p>It&#8217;s time to add some code to interact with the state machine ... and speak about the value_factory.
Values are used to interact with nodes : update config, poll, location, get temperature, ...
To allow developpers to share these interactions, there is the value factory.
You can collect values in your local values factory using :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">jnt_collect</span> <span class="o">-</span><span class="n">t</span> <span class="n">janitoo</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">-------------------------------------------------------------------------------</span>
<span class="n">Group</span> <span class="p">:</span> <span class="n">janitoo</span><span class="o">.</span><span class="n">values</span>
 <span class="n">action_boolean</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_boolean</span>
 <span class="n">action_byte</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_byte</span>
 <span class="n">action_integer</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_integer</span>
 <span class="n">action_list</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_list</span>
 <span class="n">action_string</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_string</span>
 <span class="n">action_switch_binary</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_switch_binary</span>
 <span class="n">action_switch_multilevel</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_action_switch_multilevel</span>
 <span class="n">blink</span> <span class="o">=</span> <span class="n">janitoo_factory_exts</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">blink</span><span class="p">:</span><span class="n">make_blink</span>
 <span class="n">config_array</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">config</span><span class="p">:</span><span class="n">make_config_array</span>
 <span class="n">config_boolean</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">config</span><span class="p">:</span><span class="n">make_config_boolean</span>
 <span class="o">...</span>
 <span class="n">sensor_rotation_speed</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sensor</span><span class="p">:</span><span class="n">make_sensor_rotation_speed</span>
 <span class="n">sensor_string</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sensor</span><span class="p">:</span><span class="n">make_sensor_string</span>
 <span class="n">sensor_temperature</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sensor</span><span class="p">:</span><span class="n">make_sensor_temperature</span>
 <span class="n">sensor_voltage</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sensor</span><span class="p">:</span><span class="n">make_sensor_voltage</span>
 <span class="n">transition_fsm</span> <span class="o">=</span> <span class="n">janitoo_factory</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">action</span><span class="p">:</span><span class="n">make_transition_fsm</span>
 <span class="n">updown</span> <span class="o">=</span> <span class="n">janitoo_factory_exts</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">updown</span><span class="p">:</span><span class="n">make_updown</span>
</pre></div>
</div>
<p>For example, the value sensor_temperature is used to send a temperature :D
It defines the right units, command class, label, ...</p>
<p>We want to interact with the finish state machine, so transition_fsm is a good choice :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">uuid</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">_transition&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OID</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_factory</span><span class="p">[</span><span class="s1">&#39;transition_fsm&#39;</span><span class="p">](</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">,</span>
    <span class="n">node_uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
    <span class="n">list_items</span><span class="o">=</span><span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;trigger&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span> <span class="p">],</span>
    <span class="n">fsm_bus</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">poll_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">uuid</span><span class="p">]</span><span class="o">.</span><span class="n">create_poll_value</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">poll_value</span><span class="o">.</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">poll_value</span>
</pre></div>
</div>
<p>We defined a new value using &#8216;transition_fsm&#8217; with a list of valid items populated from the transition state machine and a refrence to the bus itself.
And that&#8217;s all. All the job is done automatically (<a class="reference external" href="https://github.com/bibi21000/janitoo_factory/blob/master/src/janitoo_factory/values/action.py#L230">here</a>).</p>
<p>As we want to poll this value, we also add a linked poll value.</p>
</div>
<div class="section" id="wake-up-baby">
<h2>Wake up baby<a class="headerlink" href="#wake-up-baby" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s time to wake-up the state machine. At first, we need to find the right value :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query node --hadd 0225/0000 --vuuid request_info_basics
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">request_info_basics</span>
<span class="o">----------</span>
<span class="n">hadd</span>       <span class="n">uuid</span>                           <span class="n">idx</span>  <span class="n">data</span>                      <span class="n">units</span>      <span class="nb">type</span>  <span class="n">genre</span> <span class="n">cmdclass</span> <span class="n">help</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">switch</span>                         <span class="mi">0</span>    <span class="n">off</span>                       <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">37</span>       <span class="n">A</span> <span class="n">switch</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">values</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">]</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">blink</span>                          <span class="mi">0</span>    <span class="n">off</span>                       <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">12803</span>    <span class="n">Blink</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_transition</span>           <span class="mi">0</span>    <span class="kc">None</span>                      <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">0</span>        <span class="n">Send</span> <span class="n">a</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">the</span> <span class="n">fsm</span>
</pre></div>
</div>
<p>Get more informations on this value :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query query --host=192.168.14.65 --hadd 0225/0000 --genre basic --uuid tutorial3_transition --cmdclass 4272 --type 1 --readonly True
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tutorial3_transition</span>
<span class="o">----------</span>
<span class="n">hadd</span>       <span class="n">uuid</span>                      <span class="n">idx</span>  <span class="n">data</span>                      <span class="n">units</span>      <span class="nb">type</span>  <span class="n">genre</span> <span class="n">cmdclass</span> <span class="n">list_items</span> <span class="n">help</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_transition</span>      <span class="mi">0</span>    <span class="kc">None</span>                      <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">4272</span>     <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;wakeup&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;sleep&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span> <span class="n">Trigger</span> <span class="n">a</span> <span class="n">transition</span> <span class="n">on</span> <span class="n">the</span> <span class="n">fsm</span> <span class="ow">or</span> <span class="n">get</span> <span class="n">the</span> <span class="n">last</span> <span class="n">triggered</span>
</pre></div>
</div>
<p>And trigger a transition from [u&#8217;wakeup&#8217;, u&#8217;report&#8217;, u&#8217;sleep&#8217;, u&#8217;ring&#8217;] :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query query --host=192.168.14.65 --hadd 0225/0000 --genre basic --uuid tutorial3_transition --cmdclass 4272 --type 1 --writeonly True --data wakeup
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tutorial3_transition</span>
<span class="o">----------</span>
<span class="n">hadd</span>       <span class="n">uuid</span>                      <span class="n">idx</span>  <span class="n">data</span>                      <span class="n">units</span>      <span class="nb">type</span>  <span class="n">genre</span> <span class="n">cmdclass</span> <span class="n">list_items</span> <span class="n">help</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_transition</span>      <span class="mi">0</span>    <span class="n">wakeup</span>                    <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">4272</span>     <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;wakeup&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;report&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;sleep&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span> <span class="n">Trigger</span> <span class="n">a</span> <span class="n">transition</span> <span class="n">on</span> <span class="n">the</span> <span class="n">fsm</span> <span class="ow">or</span> <span class="n">get</span> <span class="n">the</span> <span class="n">last</span> <span class="n">triggered</span>
</pre></div>
</div>
<p>Look at spyer :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span><span class="o">/</span><span class="n">frequency</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The frequency of the CPU&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3__cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sensor_frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0003&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPUFreq&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;MHz&quot;</span><span class="p">}</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">basic</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span><span class="o">/</span><span class="n">blink</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Blink&quot;</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;blink&quot;</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;blink&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;blink&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">},</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="s2">&quot;notify&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="s2">&quot;heartbeat&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span> <span class="s2">&quot;alert&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">12803</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0004&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Blink&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;heartbeat&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3__led&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">}</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">tutorial3_temperature</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The average temperature of tutorial.&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sensor_temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Temp&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\u00b0</span><span class="s2">C&quot;</span><span class="p">}</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">basic</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">tutorial3_transition</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Trigger a transition on the fsm or get the last triggered&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;transition_fsm&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;ring&quot;</span><span class="p">],</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_transition&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">4272</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="o">/</span><span class="n">nodes</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">request</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;9999/9990&quot;</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_transition&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">4272</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">}</span>
<span class="o">/</span><span class="n">nodes</span><span class="o">/</span><span class="mi">9999</span><span class="o">/</span><span class="mi">9990</span><span class="o">/</span><span class="n">reply</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Trigger a transition on the fsm or get the last triggered&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;9999/9990&quot;</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;transition_fsm&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;ring&quot;</span><span class="p">],</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_transition&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">4272</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">basic</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">tutorial3_transition</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;Trigger a transition on the fsm or get the last triggered&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;9999/9990&quot;</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;transition_fsm&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wakeup&quot;</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;ring&quot;</span><span class="p">],</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_transition&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">4272</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0003</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0001</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">heartbeat</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0002</span> <span class="mi">0</span> <span class="n">ONLINE</span>
<span class="o">/</span><span class="n">values</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span><span class="o">/</span><span class="n">tutorial3_state</span> <span class="mi">0</span> <span class="p">{</span><span class="s2">&quot;help&quot;</span><span class="p">:</span> <span class="s2">&quot;The state of the fsm.&quot;</span><span class="p">,</span> <span class="s2">&quot;voice_uuid&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;reply_hadd&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3&quot;</span><span class="p">,</span> <span class="s2">&quot;entry_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sensor_string&quot;</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;poll_delay&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;reporting&quot;</span><span class="p">,</span> <span class="s2">&quot;is_polled&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;is_writeonly&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;list_items&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;tutorial3_state&quot;</span><span class="p">,</span> <span class="s2">&quot;is_readonly&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;cmd_class&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s2">&quot;hadd&quot;</span><span class="p">:</span> <span class="s2">&quot;0225/0000&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">}</span>
</pre></div>
</div>
<p>The values are published regulary. You should also see your led blinking in heartbeat mode.</p>
</div>
<div class="section" id="critical-temperature">
<h2>Critical temperature<a class="headerlink" href="#critical-temperature" title="Permalink to this headline">¶</a></h2>
<p>We want to notify when a temperature become critical. To do that, we add 2 values and a thread timer that will check temperatures.
If a temperature is higher than the critical one, we transit in ringing mode.</p>
<p>The on_check timer start/stop is managed entering / exiting the sleeping state :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_enter_sleeping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - on_enter_sleeping&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus_acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_check</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">remove_polls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polled_sensors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="s1">&#39;led&#39;</span><span class="p">,</span> <span class="s1">&#39;blink&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;off&#39;</span>
        <span class="c1">#In sleeping mode, send the state of the fsm every 900 seconds</span>
        <span class="c1">#We update poll_delay directly to nto update the value in config file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">poll_delay</span> <span class="o">=</span> <span class="mi">900</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - Error in on_enter_sleeping&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_release</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_exit_sleeping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - on_exit_sleeping&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_check</span><span class="p">()</span>
</pre></div>
</div>
<p>The overheat value is updated in the on_check timer :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">criticals</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;ringing&#39;</span><span class="p">:</span>
        <span class="c1">#We should notify a security problem : fire ?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">()</span>
<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;ringing&#39;</span><span class="p">:</span>
    <span class="c1">#We should notify a security problem : fire ?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<p>In ringing state, we are more verbose :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_enter_ringing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - on_enter_ringing&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus_acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="s1">&#39;led&#39;</span><span class="p">,</span> <span class="s1">&#39;blink&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
        <span class="c1">#In sleeping mode, send the state of the fsm every 900 seconds</span>
        <span class="c1">#We update poll_delay directly to not update the value in configfile</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">poll_delay</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;state_poll&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="n">overheat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat&#39;</span><span class="p">)</span>
        <span class="n">overheat</span><span class="o">.</span><span class="n">poll_delay</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">find_bus_value</span><span class="p">(</span><span class="s1">&#39;overheat_poll&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">publish_value</span><span class="p">(</span><span class="n">overheat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeman</span><span class="o">.</span><span class="n">add_polls</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="n">overheat</span><span class="p">],</span> <span class="n">slow_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] - Error in on_enter_ringing&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_release</span><span class="p">()</span>
</pre></div>
</div>
<p>We also launch the on_check temperature more frequently :</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_timer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_started</span><span class="p">:</span>
    <span class="n">timer_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bus_value</span><span class="p">(</span><span class="s1">&#39;timer_delay&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;ringing&#39;</span><span class="p">:</span>
        <span class="n">timer_delay</span> <span class="o">=</span> <span class="n">timer_delay</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_timer</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">timer_delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_check</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>It&#8217;s time to ring :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query query --host=192.168.14.65 --hadd 0225/0000 --genre basic --uuid tutorial3_transition --cmdclass 4272 --type 1 --writeonly True --data ring
</pre></div>
</div>
<p>And check that the state is ringing. You can also look at your led, should blink faster :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query node --host=192.168.14.65 --hadd 0225/0000 --vuuid request_info_basics
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">----------</span>
<span class="n">hadd</span>       <span class="n">uuid</span>                           <span class="n">idx</span>  <span class="n">data</span>                      <span class="n">units</span>      <span class="nb">type</span>  <span class="n">genre</span> <span class="n">cmdclass</span> <span class="n">help</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">switch</span>                         <span class="mi">0</span>    <span class="n">off</span>                       <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">37</span>       <span class="n">A</span> <span class="n">switch</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">values</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">]</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">blink</span>                          <span class="mi">0</span>    <span class="n">warning</span>                   <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">12803</span>    <span class="n">Blink</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_transition</span>           <span class="mi">0</span>    <span class="n">ring</span>                      <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">4272</span>     <span class="n">Trigger</span> <span class="n">a</span> <span class="n">transition</span> <span class="n">on</span> <span class="n">the</span> <span class="n">fsm</span> <span class="ow">or</span> <span class="n">get</span> <span class="n">the</span> <span class="n">last</span> <span class="n">triggered</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_state</span>                <span class="mi">0</span>    <span class="n">ringing</span>                   <span class="kc">None</span>       <span class="mi">8</span>     <span class="mi">1</span>     <span class="mi">49</span>       <span class="n">The</span> <span class="n">state</span> <span class="n">of</span> <span class="n">the</span> <span class="n">fsm</span><span class="o">.</span>
</pre></div>
</div>
<p>After a while, the state returns in reporting state :</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ jnt_query node --host=192.168.14.65 --hadd 0225/0000 --vuuid request_info_basicsrequest_info_basics
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">----------</span>
<span class="n">hadd</span>       <span class="n">uuid</span>                           <span class="n">idx</span>  <span class="n">data</span>                      <span class="n">units</span>      <span class="nb">type</span>  <span class="n">genre</span> <span class="n">cmdclass</span> <span class="n">help</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">switch</span>                         <span class="mi">0</span>    <span class="n">off</span>                       <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">37</span>       <span class="n">A</span> <span class="n">switch</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">values</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">]</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0004</span>  <span class="n">blink</span>                          <span class="mi">0</span>    <span class="n">heartbeat</span>                 <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">12803</span>    <span class="n">Blink</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_transition</span>           <span class="mi">0</span>    <span class="n">wakeup</span>                    <span class="kc">None</span>       <span class="mi">5</span>     <span class="mi">1</span>     <span class="mi">4272</span>     <span class="n">Trigger</span> <span class="n">a</span> <span class="n">transition</span> <span class="n">on</span> <span class="n">the</span> <span class="n">fsm</span> <span class="ow">or</span> <span class="n">get</span> <span class="n">the</span> <span class="n">last</span> <span class="n">triggered</span>
<span class="mi">0225</span><span class="o">/</span><span class="mi">0000</span>  <span class="n">tutorial3_state</span>                <span class="mi">0</span>    <span class="n">reporting</span>                 <span class="kc">None</span>       <span class="mi">8</span>     <span class="mi">1</span>     <span class="mi">49</span>       <span class="n">The</span> <span class="n">state</span> <span class="n">of</span> <span class="n">the</span> <span class="n">fsm</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="fsmbus">
<h2>FsmBus<a class="headerlink" href="#fsmbus" title="Permalink to this headline">¶</a></h2>
<p>A note ont the state machine.
Writing this tutorial, I added a new bus with an integrated state machine (<a class="reference external" href="https://github.com/bibi21000/janitoo_factory/blob/master/src/janitoo_factory/buses/fsm.py">here</a>).
It use a timer to speed up the boot process.
You can look at the tutorial4 code, it use it.</p>
<img alt="_images/fsm_bus_4.png" src="_images/fsm_bus_4.png" />
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014,2015,2016 Sébastien GALLET aka bibi2100 &lt;bibi21000@gmail.com&gt;.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>