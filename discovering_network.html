<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Discovering network &mdash; janitoo_tutorial 0.0.7 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.4/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="janitoo_tutorial 0.0.7 documentation" href="index.html" />
    <link rel="next" title="HelloWord V4" href="hello_world_v4.html" />
    <link rel="prev" title="Many servers" href="many_servers.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          janitoo_tutorial</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.7</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="tools/index.html">Tools</a></li>
                <li><a href="api/index.html">Reference</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html"> What is Janitoo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preface.html#preface">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#about-this-tutorial">About this tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="preface.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html"> Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#needed-tools">Needed tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#initial-clone">Initial clone</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-mosquitto">Install mosquitto</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-modules">Install modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-client-tools">Install Client tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#update-your-clone">Update your clone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v0.html"> Hello World : connect everything</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#needed-parts">Needed parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v0.html#fritzing">Fritzing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v1.html"> Hello World 1 : a simple server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#test-it">Test it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#launch-it">Launch it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#query-it">Query it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v1.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v2.html"> Hello World 2 : an advanced server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-components">The components</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-bus">The bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#the-thread">The thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#entry-points">Entry-points</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#test-it">Test it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#launch-it">Launch it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v2.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v3.html"> Hello World 3 : a more advanced server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#the-bus">The bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#the-finish-state-machine">The finish state machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#create-a-server">Create a server</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#spy-it">Spy it</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#start-it-at-boot">Start it at boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v3.html#performances">Performances</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="many_servers.html"> Many servers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#mosquitto">Mosquitto</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#the-docker-appliance">The docker appliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#home-automation">Home automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="many_servers.html#the-network">The network</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href=""> Discovering the network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#one-more-server">One more server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#broadcast-network">Broadcast network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#request-nodes">Request nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#values-querying">Values querying</a></li>
<li class="toctree-l2"><a class="reference internal" href="#command-class-discovering">Command class discovering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-servers">More servers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hello_world_v4.html"> Hello World 4 : interacting with our server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v4.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v4.html#state-machine">State machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v4.html#wake-up-baby">Wake up baby</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v4.html#critical-temperature">Critical temperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello_world_v4.html#fsmbus">FsmBus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tkinter.html"> Tk user interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#id1">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#the-map">The map</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#the-contextual-menu">The contextual menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="tkinter.html#future">Future</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="more.html"> Create and share</a><ul>
<li class="toctree-l2"><a class="reference internal" href="more.html#goal">Goal</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#how">How</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#bus-aggregation-vs-bus-extension">Bus aggregation vs bus extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#remote-development">Remote development</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#i-want-more">I want more</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#i-want-to-help">I want to help</a></li>
<li class="toctree-l2"><a class="reference internal" href="more.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using_doc.html"> Using documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="using_doc.html#the-header">The header</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="many_servers.html" title="Previous Chapter: Many servers"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Many servers</span>
    </a>
  </li>
  <li>
    <a href="hello_world_v4.html" title="Next Chapter: HelloWord V4"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">HelloWord V4 &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="discovering-network">
<h1>Discovering network<a class="headerlink" href="#discovering-network" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goal">
<h2>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h2>
<p>More servers for this parts and more about network too.</p>
</div>
<div class="section" id="one-more-server">
<h2>One more server<a class="headerlink" href="#one-more-server" title="Permalink to this headline">¶</a></h2>
<p>We need another server it&#8217;s not mandatory but it&#8217;s also a way to speak about Janitoo deploying.
For example, we want to monitor our UPS.</p>
<p>You&#8217;ve got may way to do that.</p>
<p>In the first tutorial (<a class="reference internal" href="hello_world_v1.html"><em>here</em></a>), we defined 3 bus in the configuration file.
We can do the same by adding a bus section in the configuration file of a running server (of course after installing the needed modules) :</p>
<div class="code bash highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">nut</span><span class="p">]</span>
<span class="n">auto_start</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">heartbeat</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">config_timeout</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">hadd</span> <span class="o">=</span> <span class="mi">1045</span><span class="o">/</span><span class="mo">0000</span>
<span class="n">components</span><span class="o">.</span><span class="n">ups1</span> <span class="o">=</span> <span class="n">nut</span><span class="o">.</span><span class="n">ups</span>
<span class="n">components</span><span class="o">.</span><span class="n">ups2</span> <span class="o">=</span> <span class="n">nut</span><span class="o">.</span><span class="n">ups</span>
</pre></div>
</div>
<p>Doing this way, both buses will be launched in the same processus.
Remember that the GIL will surely block your code on a core, so a single core will hold your 2 appliances.
If a bus is not fair with resources (cpu, io, ...) the other one will be impacted.
Same if a bus fails.</p>
<p>In the <a class="reference internal" href="hello_world_v2.html"><em>second</em></a> and <a class="reference internal" href="hello_world_v3.html"><em>third</em></a> tutorials,
we aggregate 2 buses with python code. Your code will also stay on the same core.</p>
<p>We don&#8217;t see it before but you can install many servers on the same rasberry but :</p>
<ul class="simple">
<li>don&#8217;t share i2c, spi, ... between servers. You can safely launch one with spi and the other one with i2c</li>
<li>you can share gpio as long as you use it on differents pins</li>
<li>you must use different configuration file, server name, log file, ...</li>
</ul>
<p>Each server run in its own processus, so it&#8217;s much interessant on a multi-core machine.
If a server crash, the other should not be impacted.</p>
<p>At last, you can create your own docker appliance to deploy your servers at home.
Docker appliances are a simple way to deploy Janitoo too.
You need to install docker (Linux, Windows, MacOS, ...)
and deploy appliance in 3 commands.</p>
<p>A typical docker file for hostsensor and NUT should be like :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>FROM bibi21000/janitoo_docker_appliance

MAINTAINER bibi21000 &lt;bibi21000@gmail.com&gt;

WORKDIR /opt/janitoo/src

RUN make clone module=janitoo_nut &amp;&amp; \
    make appliance-deps module=janitoo_nut &amp;&amp; \
    apt-get clean &amp;&amp; rm -Rf /tmp/*||true &amp;&amp; \
    [ -d /root/.cache ] &amp;&amp; rm -Rf /root/.cache/*

RUN make clone module=janitoo_hostsensor &amp;&amp; \
    make clone module=janitoo_hostsensor_psutil &amp;&amp; \
    make clone module=janitoo_hostsensor_lmsensor &amp;&amp; \
    make appliance-deps module=janitoo_hostsensor &amp;&amp; \
    apt-get clean &amp;&amp; rm -Rf /tmp/*|| true &amp;&amp; \
    [ -d /root/.cache ] &amp;&amp; rm -Rf /root/.cache/*

VOLUME [&quot;/root/.ssh/&quot;, &quot;/etc/ssh/&quot;, &quot;/opt/janitoo/etc/&quot;]

EXPOSE 22

CMD [&quot;/root/auto.sh&quot;]
</pre></div>
</div>
<p>After this explanations, install the NUT appliance docker from here : <a class="reference external" href="https://bibi21000.github.io/janitoo_nut/docker.html">https://bibi21000.github.io/janitoo_nut/docker.html</a>.
If you don&#8217;t have an UPS, enter erronous informations and you will get a failed UPS.
Okay, okay, it&#8217;s not mandatory but ...</p>
</div>
<div class="section" id="broadcast-network">
<h2>Broadcast network<a class="headerlink" href="#broadcast-network" title="Permalink to this headline">¶</a></h2>
<p>Janitoo&#8217;s protocol support broadcast. That mean that you can ask all nodes on ther server to send their configuration, ... and so on.</p>
<p>That&#8217;s the way we discover the nodes in the last tutorial :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query network --host=192.168.14.65
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>request_info_nodes
----------
hadd       uuid                 name                      location                  product_type
0121/0003  hostsensor__uptime   Uptime                    Docker                    Software component
0121/0001  hostsensor__load     Load                      Docker                    Software component
0121/0002  hostsensor__disks    Disks                     Docker                    Software component
0121/0000  hostsensor           Docker sensors            Docker                    Default product type
0121/0004  hostsensor__lmsensor lm-sensors                Docker                    Software
0120/0000  nut                  Default bus name controller Default location          Default product type
0120/0001  nut__ups1            UPS                       Default location          3B1006X72726
0225/0000  tutorial3            Hello world               Rapsberry                 Default product type
0225/0002  tutorial3__temperature Temperature               Onewire                   Temperature sensor
0225/0004  tutorial3__led       Led                       GPIO                      Software
0225/0003  tutorial3__cpu       CPU                       Hostsensor                Software component
0225/0001  tutorial3__ambiance  Ambiance 1                DHT                       Temperature/humidity sensor
</pre></div>
</div>
<p>But you can also ask for systems values.
System values are used by the protocol, you should not update or remove them in your code.</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query network --host=192.168.14.65 --vuuid=request_info_systems
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>request_info_systems
----------
hadd       node_uuid                 uuid                      idx  data                      units      type  genre cmdclass help
0120/0001  nut__ups1                 heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0120/0001  nut__ups1                 config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0120/0001  nut__ups1                 hadd                      0    0120/0001                            32    4     112      The Janitoo Home address
0120/0000  nut                       heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0120/0000  nut                       config_timeout            0    5.0                       seconds    4     4     112      The config timeout before applying configuration and rebooting
0120/0000  nut                       hadd                      0    0120/0000                            32    4     112      The Janitoo Home address
0121/0000  hostsensor                heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0000  hostsensor                config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0000  hostsensor                hadd                      0    0121/0000                            32    4     112      The Janitoo Home address
0121/0001  hostsensor__load          heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0001  hostsensor__load          config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0001  hostsensor__load          hadd                      0    0121/0001                            32    4     112      The Janitoo Home address
0121/0002  hostsensor__disks         heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0002  hostsensor__disks         config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0002  hostsensor__disks         hadd                      0    0121/0002                            32    4     112      The Janitoo Home address
0121/0003  hostsensor__uptime        heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0003  hostsensor__uptime        config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0003  hostsensor__uptime        hadd                      0    0121/0003                            32    4     112      The Janitoo Home address
0121/0004  hostsensor__lmsensor      heartbeat                 0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0004  hostsensor__lmsensor      config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0004  hostsensor__lmsensor      hadd                      0    0121/0004                            32    4     112      The Janitoo Home address
0225/0004  tutorial3__led            heartbeat                 0    30                        seconds    4     4     112      The heartbeat delay in seconds
0225/0004  tutorial3__led            config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0225/0004  tutorial3__led            hadd                      0    0225/0004                            32    4     112      The Janitoo Home address
0225/0001  tutorial3__ambiance       heartbeat                 0    30                        seconds    4     4     112      The heartbeat delay in seconds
0225/0001  tutorial3__ambiance       config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0225/0001  tutorial3__ambiance       hadd                      0    0225/0001                            32    4     112      The Janitoo Home address
0225/0000  tutorial3                 heartbeat                 0    30                        seconds    4     4     112      The heartbeat delay in seconds
0225/0000  tutorial3                 config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0225/0000  tutorial3                 hadd                      0    0225/0000                            32    4     112      The Janitoo Home address
0225/0003  tutorial3__cpu            heartbeat                 0    30                        seconds    4     4     112      The heartbeat delay in seconds
0225/0003  tutorial3__cpu            config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0225/0003  tutorial3__cpu            hadd                      0    0225/0003                            32    4     112      The Janitoo Home address
0225/0002  tutorial3__temperature    heartbeat                 0    30                        seconds    4     4     112      The heartbeat delay in seconds
0225/0002  tutorial3__temperature    config_timeout            0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0225/0002  tutorial3__temperature    hadd                      0    0225/0002                            32    4     112      The Janitoo Home address
</pre></div>
</div>
<p>When a primary node start and no other is started, it request all nodes and values of the nerwork by broadcast to create a map.
When a secondary can&#8217;t contact a primary, it fall in fail mode and use broadcast to update its map.
On all other case, the map must be build using resolv (asking to the primary node)</p>
</div>
<div class="section" id="request-nodes">
<h2>Request nodes<a class="headerlink" href="#request-nodes" title="Permalink to this headline">¶</a></h2>
<p>You can also retrieve information by asking directly to a controller one (the one is associated to the bus).
his is the requesting network.</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query node --hadd 0121/0000 --host=192.168.14.65 --vuuid=all
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>request_info_nodes
----------
hadd       uuid                           name                      location             product_type
0121/0003  hostsensor__uptime             Uptime                    Docker               Software component
0121/0001  hostsensor__load               Load                      Docker               Software component
0121/0002  hostsensor__disks              Disks                     Docker               Software component
0121/0000  hostsensor                     Docker sensors            Docker               Default product type
0121/0004  hostsensor__lmsensor           lm-sensors                Docker               Software

request_info_users
----------
0121/0004  hostsensor__lmsensor      voltage                        0    None                      V          3     2     49       The voltage from lm-sensors
0121/0004  hostsensor__lmsensor      temperature                    0    47.0                      °C         3     2     49       The temperatures from lm-sensors

request_info_configs
----------
0121/0000  hostsensor                location                       0    Docker                    None       8     3     112      The location of the node
0121/0000  hostsensor                name                           0    Docker sensors            None       8     3     112      The name of the node
0121/0001  hostsensor__load          load_config                    1    5 minutes                 None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          load_config                    0    1 minutes                 None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          load_config                    2    15 minutes                None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          location                       0    Docker                    None       8     3     112      The location of the node
0121/0001  hostsensor__load          load_poll                      0    60                        seconds    4     3     112      The poll delay of the value
0121/0001  hostsensor__load          name                           0    Load                      None       8     3     112      The name of the node
0121/0002  hostsensor__disks         partition_poll                 0    1800                      seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         free_config                    0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         partition_config               0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         name                           0    Disks                     None       8     3     112      The name of the node
0121/0002  hostsensor__disks         total_poll                     0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         total_config                   0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         used_poll                      0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         free_poll                      0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         percent_use_config             0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         used_config                    0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         location                       0    Docker                    None       8     3     112      The location of the node
0121/0002  hostsensor__disks         percent_use_poll               0    900                       seconds    4     3     112      The poll delay of the value
0121/0003  hostsensor__uptime        location                       0    Docker                    None       8     3     112      The location of the node
0121/0003  hostsensor__uptime        name                           0    Uptime                    None       8     3     112      The name of the node
0121/0003  hostsensor__uptime        uptime_poll                    0    300                       seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      temperature_poll               0    60                        seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      name                           0    lm-sensors                None       8     3     112      The name of the node
0121/0004  hostsensor__lmsensor      voltage_config                 0    None                      None       8     3     112      The name of the lmsensor
0121/0004  hostsensor__lmsensor      voltage_poll                   0    90                        seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      location                       0    Docker                    None       8     3     112      The location of the node
0121/0004  hostsensor__lmsensor      temperature_config             0    temp1                     None       8     3     112      The name of the lmsensor
0121/0004  hostsensor__lmsensor      config_filename                0    /etc/sensors3.conf        None       8     3     112      The full path/name of config file to use

request_info_systems
----------
0121/0000  hostsensor                heartbeat                      0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0000  hostsensor                config_timeout                 0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0000  hostsensor                hadd                           0    0121/0000                            32    4     112      The Janitoo Home address
0121/0001  hostsensor__load          heartbeat                      0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0001  hostsensor__load          config_timeout                 0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0001  hostsensor__load          hadd                           0    0121/0001                            32    4     112      The Janitoo Home address
0121/0002  hostsensor__disks         heartbeat                      0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0002  hostsensor__disks         config_timeout                 0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0002  hostsensor__disks         hadd                           0    0121/0002                            32    4     112      The Janitoo Home address
0121/0003  hostsensor__uptime        heartbeat                      0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0003  hostsensor__uptime        config_timeout                 0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0003  hostsensor__uptime        hadd                           0    0121/0003                            32    4     112      The Janitoo Home address
0121/0004  hostsensor__lmsensor      heartbeat                      0    60                        seconds    4     4     112      The heartbeat delay in seconds
0121/0004  hostsensor__lmsensor      config_timeout                 0    3                         seconds    4     4     112      The config timeout before applying configuration and rebooting
0121/0004  hostsensor__lmsensor      hadd                           0    0121/0004                            32    4     112      The Janitoo Home address

request_info_basics
----------
0121/0001  hostsensor__load          load                           1    0.32                      None       3     1     49       The load average
0121/0001  hostsensor__load          load                           0    0.4                       None       3     1     49       The load average
0121/0001  hostsensor__load          load                           2    0.43                      None       3     1     49       The load average
0121/0002  hostsensor__disks         total                          0    98294312960               Bytes      4     1     49       The total size of partitions
0121/0002  hostsensor__disks         used                           0    27372388352               Bytes      4     1     49       The used size of partitions
0121/0002  hostsensor__disks         percent_use                    0    27.8                      %          3     1     49       The percent_use of partitions
0121/0002  hostsensor__disks         free                           0    65905172480               Bytes      4     1     49       The free size of partitions
0121/0002  hostsensor__disks         partition                      0    /opt/janitoo/etc          None       8     1     49       The partition list
0121/0003  hostsensor__uptime        uptime                         0    172282.96                 None       3     1     49       Uptime in seconds

request_info_commands
----------
</pre></div>
</div>
<p>This this the way primary and secondary nodes discover new nodes. When the receive an heartbeat from an unknown node, they &#8220;request&#8221; informations.</p>
</div>
<div class="section" id="values-querying">
<h2>Values querying<a class="headerlink" href="#values-querying" title="Permalink to this headline">¶</a></h2>
<p>You can query a config value (setting or getting it) or a user one (ie setting a dimmer), ...</p>
<p>For example, we will get the list of configs values :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query node --hadd 0121/0000 --vuuid request_info_configs
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>hadd       node_uuid                 uuid                           idx  data                      units      type  genre cmdclass help
0121/0000  hostsensor                location                       0    Docker                    None       8     3     112      The location of the node
0121/0000  hostsensor                name                           0    Docker sensors            None       8     3     112      The name of the node
0121/0001  hostsensor__load          load_config                    1    5 minutes                 None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          load_config                    0    1 minutes                 None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          load_config                    2    15 minutes                None       2     3     112      The load average index (1, 5, and 15m)
0121/0001  hostsensor__load          location                       0    Docker                    None       8     3     112      The location of the node
0121/0001  hostsensor__load          load_poll                      0    60                        seconds    4     3     112      The poll delay of the value
0121/0001  hostsensor__load          name                           0    Load                      None       8     3     112      The name of the node
0121/0002  hostsensor__disks         partition_poll                 0    1800                      seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         free_config                    0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         partition_config               0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         name                           0    Disks                     None       8     3     112      The name of the node
0121/0002  hostsensor__disks         total_poll                     0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         total_config                   0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         used_poll                      0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         free_poll                      0    900                       seconds    4     3     112      The poll delay of the value
0121/0002  hostsensor__disks         percent_use_config             0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         used_config                    0    /opt/janitoo/etc          None       8     3     112      The partition path
0121/0002  hostsensor__disks         location                       0    Docker                    None       8     3     112      The location of the node
0121/0002  hostsensor__disks         percent_use_poll               0    900                       seconds    4     3     112      The poll delay of the value
0121/0003  hostsensor__uptime        location                       0    Docker                    None       8     3     112      The location of the node
0121/0003  hostsensor__uptime        name                           0    Uptime                    None       8     3     112      The name of the node
0121/0003  hostsensor__uptime        uptime_poll                    0    300                       seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      temperature_poll               0    60                        seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      name                           0    lm-sensors                None       8     3     112      The name of the node
0121/0004  hostsensor__lmsensor      voltage_config                 0    None                      None       8     3     112      The name of the lmsensor
0121/0004  hostsensor__lmsensor      voltage_poll                   0    90                        seconds    4     3     112      The poll delay of the value
0121/0004  hostsensor__lmsensor      location                       0    Docker                    None       8     3     112      The location of the node
0121/0004  hostsensor__lmsensor      temperature_config             0    temp1                     None       8     3     112      The name of the lmsensor
0121/0004  hostsensor__lmsensor      config_filename                0    /etc/sensors3.conf        None       8     3     112      The full path/name of config file to use
</pre></div>
</div>
<p>We&#8217;ll update the location of the controller node :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>hadd       node_uuid                 uuid                           idx  data                      units      type  genre cmdclass help
0121/0000  hostsensor                location                       0    Docker                    None       8     3     112      The location of the node
</pre></div>
</div>
<p>Use the previous type, uuid, genre and cmdclass to create the query.
Set data to what you want. Add &#8211;writeonly True to set the value :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query query --host=192.168.14.65 --hadd 0121/0000 --genre config --uuid location --data &quot;My computer&quot; --cmdclass 112 --type 8 --writeonly True

location
----------
hadd       uuid                      idx  data                      units      type  genre cmdclass help
0121/0000  location                  0    My computer               None       None  3     112      The location of the node
</pre></div>
</div>
<p>You can get a value using &#8211;writeonly True :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query query --host=192.168.14.65 --hadd 0121/0000 --genre config --uuid location --cmdclass 112 --readonly True

location
----------
hadd       uuid                      idx  data                      units      type  genre cmdclass help
0121/0000  location                  0    My computer               None       None  3     112      The location of the node
</pre></div>
</div>
<p>Update the poll delay of the load value :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>hadd       node_uuid                 uuid                           idx  data                      units      type  genre cmdclass help
0121/0001  hostsensor__load          load_poll                      0    60                        seconds    4     3     112      The poll delay of the value
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query query --host=192.168.14.65 --hadd 0121/0001 --genre config --uuid load_poll --data 10 --cmdclass 112 --type 4 --writeonly True

load_poll
----------
hadd       uuid                      idx  data                      units      type  genre cmdclass help
0121/0001  load_poll                 0    10                        None       None  3     112      The poll delay of the value
</pre></div>
</div>
<p>Requery the config values :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_query node --hadd 0121/0000 --vuuid request_info_configs --host 192.168.14.65
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>request_info_configs
----------
hadd       uuid                           idx  data                      units      type  genre cmdclass help
...
0121/0000  location                       0    My computer               None       8     3     112      The location of the node
...
0121/0001  load_poll                      0    10                        seconds    4     3     112      The poll delay of the value
...
</pre></div>
</div>
<p>You can connect to docker appliance to check the configuration file :</p>
<div class="code bash highlight-python"><div class="highlight"><pre>root@7de7e4993b13:~# cat /opt/janitoo/etc/janitoo_hostsensor.conf
</pre></div>
</div>
<div class="code bash highlight-python"><div class="highlight"><pre>[hostsensor]
auto_start = True
components.load = hostsensor.load
components.uptime = hostsensor.uptime
components.disks = hostsensor.disks
components.lmsensor = hostsensor.lmsensor
heartbeat = 60
name = Docker sensors
location = My cumputer
hadd = 0121/0000
uuid = d6b66de0-21ed-11e6-ae4d-0242ac110002
...
[hostsensor__load]
heartbeat = 60
name = Load
location = Docker
hadd = 0121/0001
load_poll_0 = 10
</pre></div>
</div>
<p>You can also spy the values update and check that the load value is published every 10 seconds.</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ jnt_spy --host 192.168.14.65 --topic /values/#

&gt;&gt;&gt;&gt;&gt;&gt; Subscribe to /values/#
!!!!!! Connect rc : 0
!!!!!! Subscribed to None : 1 (0,)
!!!!!! Type Ctrl+C 2 times to exit !!!!!!
/values/basic/0121/0001/load 0 {&quot;0&quot;: {&quot;help&quot;: &quot;The load average&quot;, &quot;max&quot;: null, &quot;reply_hadd&quot;: null, &quot;entry_name&quot;: &quot;sensor_float&quot;, &quot;genre&quot;: 1, &quot;poll_delay&quot;: 10,
 &quot;data&quot;: 0.31, &quot;is_writeonly&quot;: false, &quot;list_items&quot;: null, &quot;index&quot;: 0, &quot;node_uuid&quot;: &quot;hostsensor__load&quot;, &quot;uuid&quot;: &quot;load&quot;, &quot;voice_uuid&quot;: null, &quot;min&quot;: null, &quot;defau
lt&quot;: null, &quot;cmd_class&quot;: 49, &quot;hadd&quot;: &quot;0121/0001&quot;, &quot;label&quot;: &quot;Load (1 minutes)&quot;, &quot;units&quot;: null, &quot;is_readonly&quot;: true, &quot;is_polled&quot;: true, &quot;type&quot;: 3}, &quot;1&quot;: {&quot;help&quot;:
 &quot;The load average&quot;, &quot;max&quot;: null, &quot;reply_hadd&quot;: null, &quot;entry_name&quot;: &quot;sensor_float&quot;, &quot;genre&quot;: 1, &quot;poll_delay&quot;: 10, &quot;data&quot;: 0.49, &quot;is_writeonly&quot;: false, &quot;list_i
tems&quot;: null, &quot;index&quot;: 1, &quot;node_uuid&quot;: &quot;hostsensor__load&quot;, &quot;uuid&quot;: &quot;load&quot;, &quot;voice_uuid&quot;: null, &quot;min&quot;: null, &quot;default&quot;: null, &quot;cmd_class&quot;: 49, &quot;hadd&quot;: &quot;0121/000
1&quot;, &quot;label&quot;: &quot;Load (5 minutes)&quot;, &quot;units&quot;: null, &quot;is_readonly&quot;: true, &quot;is_polled&quot;: true, &quot;type&quot;: 3}, &quot;2&quot;: {&quot;help&quot;: &quot;The load average&quot;, &quot;max&quot;: null, &quot;reply_hadd
&quot;: null, &quot;entry_name&quot;: &quot;sensor_float&quot;, &quot;genre&quot;: 1, &quot;poll_delay&quot;: 10, &quot;data&quot;: 0.59, &quot;is_writeonly&quot;: false, &quot;list_items&quot;: null, &quot;index&quot;: 2, &quot;node_uuid&quot;: &quot;hostse
nsor__load&quot;, &quot;uuid&quot;: &quot;load&quot;, &quot;voice_uuid&quot;: null, &quot;min&quot;: null, &quot;default&quot;: null, &quot;cmd_class&quot;: 49, &quot;hadd&quot;: &quot;0121/0001&quot;, &quot;label&quot;: &quot;Load (15 minutes)&quot;, &quot;units&quot;: nu
ll, &quot;is_readonly&quot;: true, &quot;is_polled&quot;: true, &quot;type&quot;: 3}}
</pre></div>
</div>
<p>You can get the documentation about <a class="reference external" href="https://bibi21000.github.io/janitoo/cli.html#jnt-query">jnt_query</a>.</p>
</div>
<div class="section" id="command-class-discovering">
<h2>Command class discovering<a class="headerlink" href="#command-class-discovering" title="Permalink to this headline">¶</a></h2>
<p>Requesting and broadcasting informations create a lot of traffic on the network. So It&#8217;s better to not use it on commons nodes.
It should be reserved to primary or sencondaries nodes.</p>
<p>But sometimes it&#8217;s necessary. So if you really need it, use the resolv method.</p>
<p>We spoke many times about primary and secondaries ... but never about their implementation / deployement.</p>
<p>Typically, a primary is a Dynamic Home Configuration Protocol (DHCP), it will store the configuration of all nodes (using a db or not).
Actually, it about 20% finish ... so not usuable. And maybe we should do some updates on protocol.
That&#8217;s why we set the HADD manually in the configuration file ...</p>
<p>And secondaries ?</p>
<p>Technically, every thread or server (in Janitoo API) can be a secondary. But a secondary hold a full map of the network (maybe more than 1000 values)
and it will consume RAM and cpu (to take the map up to date).</p>
<p>Typically, a user interface (<a class="reference external" href="https://github.com/bibi21000/janitoo_manager">janitoo_manager</a>) which needs to list nodes, values, should be a secondary.</p>
<p>A notifier, which needs to call many nodes (an email notifier, a sms notifier, a tv message, a ring on an raspberry)  may
be a secondary too.</p>
<p>Typically, if you want your server become a secondary, you should extend the default network :</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyNetwork</span><span class="p">(</span><span class="n">JNTNetwork</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The network manager for the flask application</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">JNTNetwork</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extend_from_entry_points</span><span class="p">(</span><span class="s">&#39;janitoo_tutorial&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">emit_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emit a network state event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;state_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_str</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;nodes_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_count</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;home_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_id</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;is_failed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_failed</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;is_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_secondary</span><span class="p">,</span>
        <span class="n">ret</span><span class="p">[</span><span class="s">&#39;is_primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_primary</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">extend_from_entry_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Extend the network with methods found in entrypoints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entrypoint</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.network&#39;</span><span class="o">%</span><span class="n">group</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Extend network with </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">module_name</span> <span class="p">)</span>
            <span class="n">extend</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">extend</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
</pre></div>
</div>
<p>And you need to start/stop it the right place in your server (janitoo_dhcp <a href="#id1"><span class="problematic" id="id2">`https://github.com/bibi21000/janitoo_dhcp/blob/master/src/janitoo_dhcp/server.py`_</span></a>)</p>
<p>The network object will do all the requests / broadcast to populate the map : with a working primary (and some code fixes :)),
it should be up in less than 10 seconds.
With no primary, it take at least 30 seconds and surely more on large installations.
Look at the video on youtube or install the janitoo_manager package.</p>
<p>This example is copy/paste from the dhcp server, which is written with an old release of Janitoo.
Contact the core team if you need to develop a secondary node.</p>
<p>Back to the command classes : they are a way to organize nodes/values, it represents a capacity of a node :
ie a switch implement the cmdclass COMMAND_SWITCH_BINARY.
For a dimmer, it is COMMAND_SWITCH_MULTILEVEL.</p>
<div class="section" id="primary-or-secondaries">
<h3>Primary or secondaries<a class="headerlink" href="#primary-or-secondaries" title="Permalink to this headline">¶</a></h3>
<p>On a primary or secondary, you can extend the network object to collect command classes :</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">find_webcontrollers</span><span class="p">():</span>
     <span class="sd">&quot;&quot;&quot;Return a dict with the web controller</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
     <span class="n">web_servers</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">COMMAND_WEB_CONTROLLER</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s">&#39;cmd_classes&#39;</span><span class="p">]]</span>
     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">web_servers</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">:</span>
             <span class="n">res</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
             <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                 <span class="n">res</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                 <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">]:</span>
                     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;cmd_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">COMMAND_WEB_CONTROLLER</span><span class="p">:</span>
                         <span class="n">res</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                             <span class="s">&#39;value_uuid&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;uuid&#39;</span><span class="p">],</span>
                             <span class="s">&#39;value_index&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">],</span>
                             <span class="s">&#39;data&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;data&#39;</span><span class="p">],</span>
                             <span class="s">&#39;label&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span>
                             <span class="s">&#39;help&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basics</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">value</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s">&#39;data&#39;</span><span class="p">],</span>
                         <span class="p">}</span>
</pre></div>
</div>
<p>This is the way the proxy extension for manager works : it collects all nodes which implements cmdclass COMMAND_WEB_CONTROLLER to show them on the web page
(̀ here &lt;<a class="reference external" href="https://github.com/bibi21000/janitoo_manager_proxy/blob/master/src/janitoo_manager_proxy/network.py">https://github.com/bibi21000/janitoo_manager_proxy/blob/master/src/janitoo_manager_proxy/network.py</a>&gt;`_).</p>
</div>
<div class="section" id="resolv">
<h3>Resolv<a class="headerlink" href="#resolv" title="Permalink to this headline">¶</a></h3>
<p>Not implemented.</p>
<p>Make a call via uuid to the primary to get a list of nodes implementing the needed command class.</p>
</div>
</div>
<div class="section" id="more-servers">
<h2>More servers<a class="headerlink" href="#more-servers" title="Permalink to this headline">¶</a></h2>
<p>You can find docker appliance here :</p>
<ul class="simple">
<li><a class="reference external" href="https://bibi21000.github.io/janitoo_docker_appliance/directory.html">https://bibi21000.github.io/janitoo_docker_appliance/directory.html</a></li>
</ul>
<p>You could find other servers here :</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/bibi21000/janitoo_nut">https://github.com/bibi21000/janitoo_nut</a></li>
<li><a class="reference external" href="https://github.com/bibi21000/janitoo_roomba">https://github.com/bibi21000/janitoo_roomba</a></li>
</ul>
<p>All this examples have configurations and tests which should help you to configure your server.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014,2015,2016 Sébastien GALLET aka bibi2100 &lt;bibi21000@gmail.com&gt;.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>